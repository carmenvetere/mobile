- sensor:
    - name: "Notification Alert Counter"
      unique_id: notification_alert_counter
      state: >
        {# ─── 1) Boolean rules (each evaluates to True/False) ─── #}
        {% set rules = [
          is_state('binary_sensor.bayberry_grid_status', 'off'),
          is_state('binary_sensor.bayberry_storm_watch_active', 'on'),
          is_state('binary_sensor.dryer_recently_completed', 'on'),
          is_state('binary_sensor.washer_recently_completed', 'on'),
          (is_state('sensor.bayberry_tempest_precipitation_type','rain')
            and is_state('binary_sensor.pool_cover_pump','off')),
          is_state('cover.garage_door_garage','open'),
          is_state('input_boolean.low_pool_water_level','on'),
          (states('sensor.roborock_s8_vacuum_error') not in ['none','unknown','unavailable'] and states('sensor.roborock_s8_vacuum_error') != ''),
          (is_state('binary_sensor.bayberry_grid_status','off')
            and states('sensor.bayberry_charge')|float(100) < 25),
          (states('sensor.nws_alerts_alerts') not in ['unknown','unavailable'] and states('sensor.nws_alerts_alerts')|int(0) > 0),
          states('sensor.front_load_washer_tub_clean_counter')|int(0) > 30,
          states('sensor.months_since_last_hot_water_flush')|float(0) > 5.9,
          states('input_number.upper_floors_hvac_filter_hours')|int(0) > 2000,
          states('input_number.lower_floors_hvac_filter_hours')|int(0) > 2000,
          states('sensor.utility_room_temp_sensor_temperature')|float(99) < 55,
          states('sensor.utility_room_temp_sensor_temperature')|float(0)  > 80,
          states('sensor.attic_temp_sensor_temperature')|float(0)  > 80,
          states('sensor.attic_temp_sensor_temperature')|float(99) < 55,
          (states('sensor.hours_since_last_vacuum')|float(0) > 48
            and is_state('binary_sensor.pool_season','on')),
          states('sensor.omnilogic_pool_chlorinator_average_salt_level')|float(9999) < 2700,
          states('sensor.smithy_hot_water_availability_2')|float(9999)   < 20
        ] %}
        {# ─── 2) Battery list and count (< 20%) ─── #}
        {% set battery_sensors = expand(
          'sensor.bedroom_back_1_battery',
          'sensor.back_2_battery',
          'sensor.back_3_battery',
          'sensor.bedroom_back_4_battery_0',
          'sensor.bedroom_back_5_battery_0',
          'sensor.side_left_battery_2',
          'sensor.side_right_battery_0',
          'sensor.dining_room_front_left_battery_0',
          'sensor.front_left_battery',
          'sensor.front_right_battery_0',
          'sensor.bedroom_right_battery_0',
          'sensor.hallway_1_battery',
          'sensor.hallway_2_battery_0',
          'sensor.bedroom_left_battery_0',
          'sensor.living_room_side_left_1_battery_0',
          'sensor.living_room_front_left_battery_0',
          'sensor.living_room_side_left_2_battery_0',
          'sensor.living_room_side_right_1_battery_0',
          'sensor.living_room_side_right_2_battery_0',
          'sensor.living_room_front_right_battery',
          'sensor.attic_temp_sensor_battery',
          'sensor.front_door_battery',
          'sensor.kitchen_french_doors_battery',
          'sensor.living_room_french_doors_battery',
          'sensor.mudroom_entry_battery',
          'sensor.mudroom_garage_battery',
          'sensor.utility_room_temp_sensor_battery',
          'sensor.back_guest_bedroom_side_battery',
          'sensor.back_guest_bedroom_back_left_battery',
          'sensor.back_guest_bedroom_back_right_battery'
        ) %}
        {% set low_batt = battery_sensors
            | map(attribute='state') | map('float', 100) | select('lt', 20) | list %}
        {% set low_batt_count = low_batt | count %}
        {# ─── 3) Final count: sum of booleans + count of low batteries ─── #}
        {{ (rules | map('int') | sum) + low_batt_count }}
      icon: mdi:alert-circle

    - name: "Lights On Count"
      unique_id: count_of_lights
      state: >
        {% set lights = [
          'light.front_foyer_pendants',
          'light.gym_main_lights',
          'light.kitchen_island_pendants',
          'light.kitchen_main_lights',
          'light.kitchen_outer_wall',
          'light.kitchen_window_seat_sconce',
          'light.laundry_room_main_lights',
          'light.living_room_floor_lamp_1',
          'light.living_room_floor_lamp_2',
          'light.living_room_main_lights',
          'light.media_room_main_lights',
          'light.media_room_table_lamp',
          'light.office_floor_lamp',
          'light.office_main_lights',
          'light.upstairs_hallway_main_lights',
          'light.basement_hallway_main_lights',
          'light.dining_room_accent_lights',
          'light.dining_room_main_lights',
          'light.dining_room_table_lamps',
          'light.driveway_sconces',
          'light.front_porch_overhead_light',
          'light.master_bathroom_main_lights',
          'light.master_bathroom_vanity_lights',
          'light.master_bedroom_main_lights',
          'light.master_bedroom_sconces',
          'light.master_bedroom_closet_light',
          'light.patio_back_porch_lights',
          'light.eve_light_strip_a5a4',
          'switch.bedroom_floor_lamp_switch',
          'switch.transformer_zone_1',
          'switch.transformer_zone_2',
          'switch.transformer_zone_3',
          'switch.transformer_zone_1_2',
          'switch.transformer_zone_2_2',
          'switch.transformer_zone_3_2'
        ] %}
        {% set on_lights = lights | select('is_state', 'on') | list %}
        {% if on_lights | length == 0 %}
          All Off
        {% else %}
          {{ on_lights | length }}
        {% endif %}

    - name: "Hours Since Last Vacuum"
      unique_id: hours_since_last_vacuum
      unit_of_measurement: "hours"
      state: >
        {% if states('input_datetime.last_pool_vacuum') %}
          {{ ((as_timestamp(now()) - as_timestamp(states.input_datetime.last_pool_vacuum.state)) / 3600) | round(1) }}
        {% else %}
          unknown
        {% endif %}

    - name: "Solcast Seven Day"
      unique_id: "solcast_seven_day"
      state: >
        {{
          states('sensor.solcast_pv_forecast_forecast_today') | float(0) +
          states('sensor.solcast_pv_forecast_forecast_tomorrow') | float(0) +
          states('sensor.solcast_pv_forecast_forecast_day_3') | float(0) +
          states('sensor.solcast_pv_forecast_forecast_day_4') | float(0) +
          states('sensor.solcast_pv_forecast_forecast_day_5') | float(0) +
          states('sensor.solcast_pv_forecast_forecast_day_6') | float(0) +
          states('sensor.solcast_pv_forecast_forecast_day_7') | float(0)
        }}
      unit_of_measurement: "kWh"
      attributes:
        detailedForecast: >
          {%
            set days = state_attr('sensor.solcast_pv_forecast_forecast_today', 'detailedForecast') +
            state_attr('sensor.solcast_pv_forecast_forecast_tomorrow', 'detailedForecast') +
            state_attr('sensor.solcast_pv_forecast_forecast_day_3', 'detailedForecast') +
            state_attr('sensor.solcast_pv_forecast_forecast_day_4', 'detailedForecast') +
            state_attr('sensor.solcast_pv_forecast_forecast_day_5', 'detailedForecast') +
            state_attr('sensor.solcast_pv_forecast_forecast_day_6', 'detailedForecast') +
            state_attr('sensor.solcast_pv_forecast_forecast_day_7', 'detailedForecast')
          %}
          {% set ns = namespace(combined_list=[]) %}
          {% for interval in days %}
            {% set ns.combined_list = ns.combined_list + [
              {
                'period_start': interval['period_start'].isoformat(),
                'pv_estimate': interval['pv_estimate'],
                'pv_estimate10': interval['pv_estimate10'],
                'pv_estimate90': interval['pv_estimate90'],
              }
            ] %}
          {% endfor %}
          {{ ns.combined_list | to_json() }}
    
    # Calculate "Other" usage
    # - name: "Home Other Usage"
    #   unique_id: home_other_usage
    #   unit_of_measurement: "kWh"
    #   device_class: energy
    #   state_class: total_increasing
    #   icon: mdi:home-lightning-bolt
    #   state: >
    #     {% set total = states('sensor.bayberry_load_import') | float(0) %}
    #     {% set well  = states('sensor.well_pump_energy2') | float(0) %}
    #     {% set pool  = states('sensor.pool_pump_energy') | float(0) if states('sensor.pool_pump_energy') not in ['unavailable', 'unknown'] else 0 %}
    #     {% set water = states('sensor.hot_water_heater') | float(0) if states('sensor.hot_water_heater') not in ['unavailable', 'unknown'] else 0 %}
    #     {% set ev    = states('sensor.wall_charger_energy') | float(0) %}

    #     {% set other = total - well - pool - water - ev %}
    #     {{ [other, 0] | max | round(2) }}

- trigger:
    - trigger: event
      event_type: bubble_card_update_modules
  sensor:
    - name: "Bubble Card Modules"
      unique_id: bubble_card_modules
      state: "saved"
      icon: "mdi:puzzle"
      attributes:
        modules: "{{ trigger.event.data.modules }}"
        last_updated: "{{ trigger.event.data.last_updated }}"

# ═══════════════════════════════════════════════════════════════════
# Scene Detection Binary Sensors
# ═══════════════════════════════════════════════════════════════════
- binary_sensor:
    - name: "Scene Good Morning"
      unique_id: scene_good_morning
      state: >
        {% set checks = [
          is_state('light.living_room_floor_lamp_1', 'on') and state_attr('light.living_room_floor_lamp_1', 'brightness') | int(0) in range(245, 266),
          is_state('light.living_room_floor_lamp_2', 'on') and state_attr('light.living_room_floor_lamp_2', 'brightness') | int(0) in range(245, 266),
          is_state('light.kitchen_main_lights', 'on') and state_attr('light.kitchen_main_lights', 'brightness') | int(0) in range(5, 26),
          is_state('light.kitchen_outer_wall', 'on') and state_attr('light.kitchen_outer_wall', 'brightness') | int(0) in range(117, 138),
          is_state('light.kitchen_island_pendants', 'on') and state_attr('light.kitchen_island_pendants', 'brightness') | int(0) in range(28, 49),
          is_state('light.kitchen_window_seat_sconce', 'on') and state_attr('light.kitchen_window_seat_sconce', 'brightness') | int(0) in range(117, 138),
          is_state('light.laundry_room_main_lights', 'off'),
          is_state('light.dining_room_main_lights', 'off'),
          is_state('light.dining_room_accent_lights', 'off'),
          is_state('light.dining_room_table_lamps', 'on') and state_attr('light.dining_room_table_lamps', 'brightness') | int(0) in range(28, 49),
          is_state('light.living_room_main_lights', 'off'),
          is_state('light.stairs_spot_lights', 'on') and state_attr('light.stairs_spot_lights', 'brightness') | int(0) in range(28, 49)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:weather-sunset-up

    - name: "Scene Good Night"
      unique_id: scene_good_night
      state: >
        {% set checks = [
          is_state('light.stairs_main_lights', 'off'),
          is_state('light.basement_hallway_main_lights', 'off'),
          is_state('light.dining_room_accent_lights', 'off'),
          is_state('light.dining_room_main_lights', 'off'),
          is_state('light.dining_room_table_lamps', 'off'),
          is_state('light.front_foyer_pendants', 'off'),
          is_state('light.upstairs_hallway_main_lights', 'off'),
          is_state('light.gym_main_lights', 'off'),
          is_state('light.kitchen_island_pendants', 'off'),
          is_state('light.kitchen_main_lights', 'off'),
          is_state('light.kitchen_outer_wall', 'off'),
          is_state('light.laundry_room_main_lights', 'off'),
          is_state('light.office_main_lights', 'off'),
          is_state('light.media_room_main_lights', 'off'),
          is_state('light.media_room_table_lamp', 'off'),
          is_state('light.office_floor_lamp', 'off'),
          is_state('light.living_room_floor_lamp_1', 'off'),
          is_state('light.living_room_floor_lamp_2', 'off'),
          is_state('light.living_room_main_lights', 'off'),
          is_state('light.kitchen_window_seat_sconce', 'off'),
          is_state('light.stairs_spot_lights', 'off'),
          is_state('light.eve_light_strip_a5a4', 'off')
        ] %}
        {{ checks | select('equalto', true) | list | count == checks | count }}
      icon: mdi:moon-waning-crescent

    - name: "Scene Nightlight"
      unique_id: scene_nightlight
      state: >
        {% set checks = [
          is_state('light.stairs_main_lights', 'off'),
          is_state('light.basement_hallway_main_lights', 'off'),
          is_state('light.dining_room_accent_lights', 'off'),
          is_state('light.dining_room_main_lights', 'off'),
          is_state('light.dining_room_table_lamps', 'off'),
          is_state('light.front_foyer_pendants', 'off'),
          is_state('light.upstairs_hallway_main_lights', 'off'),
          is_state('light.gym_main_lights', 'off'),
          is_state('light.kitchen_island_pendants', 'off'),
          is_state('light.kitchen_main_lights', 'off'),
          is_state('light.kitchen_outer_wall', 'off'),
          is_state('light.laundry_room_main_lights', 'off'),
          is_state('light.office_main_lights', 'off'),
          is_state('light.media_room_main_lights', 'off'),
          is_state('light.media_room_table_lamp', 'off'),
          is_state('light.office_floor_lamp', 'on') and state_attr('light.office_floor_lamp', 'brightness') | int(0) in range(41, 62),
          is_state('light.living_room_floor_lamp_1', 'on') and state_attr('light.living_room_floor_lamp_1', 'brightness') | int(0) in range(66, 87),
          is_state('light.living_room_floor_lamp_2', 'on') and state_attr('light.living_room_floor_lamp_2', 'brightness') | int(0) in range(66, 87),
          is_state('light.living_room_main_lights', 'off'),
          is_state('light.kitchen_window_seat_sconce', 'on') and state_attr('light.kitchen_window_seat_sconce', 'brightness') | int(0) in range(117, 138),
          is_state('light.stairs_spot_lights', 'on') and state_attr('light.stairs_spot_lights', 'brightness') | int(0) in range(15, 36),
          is_state('light.eve_light_strip_a5a4', 'on') and state_attr('light.eve_light_strip_a5a4', 'brightness') | int(0) in range(3, 23)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:lightbulb-night-outline

    - name: "Scene Emergency"
      unique_id: scene_emergency
      state: >
        {% set checks = [
          is_state('light.gym_main_lights', 'on') and state_attr('light.gym_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.kitchen_main_lights', 'on') and state_attr('light.kitchen_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.living_room_main_lights', 'on') and state_attr('light.living_room_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.upstairs_hallway_main_lights', 'on') and state_attr('light.upstairs_hallway_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.dining_room_main_lights', 'on') and state_attr('light.dining_room_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.basement_hallway_main_lights', 'on') and state_attr('light.basement_hallway_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.stairs_main_lights', 'on') and state_attr('light.stairs_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.media_room_main_lights', 'on') and state_attr('light.media_room_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.laundry_room_main_lights', 'on') and state_attr('light.laundry_room_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.patio_back_porch_lights', 'on') and state_attr('light.patio_back_porch_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.driveway_sconces', 'on') and state_attr('light.driveway_sconces', 'brightness') | int(0) in range(245, 266),
          is_state('light.front_porch_overhead_light', 'on') and state_attr('light.front_porch_overhead_light', 'brightness') | int(0) in range(245, 266),
          is_state('light.driveway_transformer_1_2', 'on'),
          is_state('switch.driveway_zone_2_2', 'on'),
          is_state('light.driveway_transformer_3_2', 'on')
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:hospital

    - name: "Scene Evening"
      unique_id: scene_evening
      state: >
        {% set checks = [
          is_state('light.dining_room_accent_lights', 'on') and state_attr('light.dining_room_accent_lights', 'brightness') | int(0) in range(28, 49),
          is_state('light.dining_room_main_lights', 'off'),
          is_state('light.dining_room_table_lamps', 'on') and state_attr('light.dining_room_table_lamps', 'brightness') | int(0) in range(66, 87),
          is_state('light.living_room_main_lights', 'on') and state_attr('light.living_room_main_lights', 'brightness') | int(0) in range(41, 62),
          is_state('light.living_room_floor_lamp_1', 'on') and state_attr('light.living_room_floor_lamp_1', 'brightness') | int(0) in range(181, 202),
          is_state('light.living_room_floor_lamp_2', 'on') and state_attr('light.living_room_floor_lamp_2', 'brightness') | int(0) in range(181, 202),
          is_state('light.kitchen_island_pendants', 'on') and state_attr('light.kitchen_island_pendants', 'brightness') | int(0) in range(41, 62),
          is_state('light.kitchen_main_lights', 'on') and state_attr('light.kitchen_main_lights', 'brightness') | int(0) in range(28, 49),
          is_state('light.kitchen_outer_wall', 'on') and state_attr('light.kitchen_outer_wall', 'brightness') | int(0) in range(28, 49),
          is_state('light.kitchen_window_seat_sconce', 'on') and state_attr('light.kitchen_window_seat_sconce', 'brightness') | int(0) in range(155, 176),
          is_state('light.front_foyer_pendants', 'off')
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:weather-sunset-down

    - name: "Scene Entertaining"
      unique_id: scene_entertaining
      state: >
        {% set checks = [
          is_state('light.living_room_floor_lamp_1', 'on') and state_attr('light.living_room_floor_lamp_1', 'brightness') | int(0) in range(117, 138),
          is_state('light.living_room_floor_lamp_2', 'on') and state_attr('light.living_room_floor_lamp_2', 'brightness') | int(0) in range(117, 138),
          is_state('light.living_room_main_lights', 'on') and state_attr('light.living_room_main_lights', 'brightness') | int(0) in range(53, 74),
          is_state('light.kitchen_island_pendants', 'on') and state_attr('light.kitchen_island_pendants', 'brightness') | int(0) in range(130, 151),
          is_state('light.kitchen_main_lights', 'on') and state_attr('light.kitchen_main_lights', 'brightness') | int(0) in range(41, 62),
          is_state('light.kitchen_outer_wall', 'on') and state_attr('light.kitchen_outer_wall', 'brightness') | int(0) in range(79, 100),
          is_state('light.kitchen_window_seat_sconce', 'on') and state_attr('light.kitchen_window_seat_sconce', 'brightness') | int(0) in range(245, 266),
          is_state('light.dining_room_accent_lights', 'on') and state_attr('light.dining_room_accent_lights', 'brightness') | int(0) in range(117, 138),
          is_state('light.dining_room_main_lights', 'on') and state_attr('light.dining_room_main_lights', 'brightness') | int(0) in range(28, 49),
          is_state('light.dining_room_table_lamps', 'on') and state_attr('light.dining_room_table_lamps', 'brightness') | int(0) in range(117, 138),
          is_state('light.front_foyer_pendants', 'on') and state_attr('light.front_foyer_pendants', 'brightness') | int(0) in range(66, 87),
          is_state('light.stairs_spot_lights', 'on') and state_attr('light.stairs_spot_lights', 'brightness') | int(0) in range(117, 138)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:glass-cocktail

    - name: "Scene First Floor Cleaning"
      unique_id: scene_first_floor_cleaning
      state: >
        {% set checks = [
          is_state('light.kitchen_main_lights', 'on') and state_attr('light.kitchen_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.kitchen_island_pendants', 'on') and state_attr('light.kitchen_island_pendants', 'brightness') | int(0) in range(245, 266),
          is_state('light.kitchen_outer_wall', 'on') and state_attr('light.kitchen_outer_wall', 'brightness') | int(0) in range(245, 266),
          is_state('light.living_room_main_lights', 'on') and state_attr('light.living_room_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.dining_room_main_lights', 'on') and state_attr('light.dining_room_main_lights', 'brightness') | int(0) in range(245, 266)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:spray-bottle

    - name: "Scene Welcome"
      unique_id: scene_welcome
      state: >
        {% set checks = [
          is_state('light.living_room_main_lights', 'on') and state_attr('light.living_room_main_lights', 'brightness') | int(0) in range(66, 87),
          is_state('light.kitchen_main_lights', 'on') and state_attr('light.kitchen_main_lights', 'brightness') | int(0) in range(66, 87),
          is_state('light.media_room_main_lights', 'on') and state_attr('light.media_room_main_lights', 'brightness') | int(0) in range(66, 87),
          is_state('light.media_room_table_lamp', 'on') and state_attr('light.media_room_table_lamp', 'brightness') | int(0) in range(66, 87),
          is_state('light.basement_hallway_main_lights', 'on') and state_attr('light.basement_hallway_main_lights', 'brightness') | int(0) in range(92, 113),
          is_state('light.front_foyer_pendants', 'on') and state_attr('light.front_foyer_pendants', 'brightness') | int(0) in range(66, 87),
          is_state('light.laundry_room_main_lights', 'on') and state_attr('light.laundry_room_main_lights', 'brightness') | int(0) in range(117, 138),
          is_state('light.upstairs_hallway_main_lights', 'on') and state_attr('light.upstairs_hallway_main_lights', 'brightness') | int(0) in range(66, 87)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:human-greeting

    - name: "Scene Basement Cleaning"
      unique_id: scene_basement_cleaning
      state: >
        {% set checks = [
          is_state('light.media_room_main_lights', 'on') and state_attr('light.media_room_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.basement_hallway_main_lights', 'on') and state_attr('light.basement_hallway_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.laundry_room_main_lights', 'on') and state_attr('light.laundry_room_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.gym_main_lights', 'on') and state_attr('light.gym_main_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.stairs_main_lights', 'on') and state_attr('light.stairs_main_lights', 'brightness') | int(0) in range(245, 266)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:spray-bottle

    - name: "Scene Basement Evening"
      unique_id: scene_basement_evening
      state: >
        {% set checks = [
          is_state('light.media_room_main_lights', 'off'),
          is_state('light.media_room_table_lamp', 'on') and state_attr('light.media_room_table_lamp', 'brightness') | int(0) in range(41, 62),
          is_state('light.basement_hallway_main_lights', 'on') and state_attr('light.basement_hallway_main_lights', 'brightness') | int(0) in range(28, 49),
          is_state('light.stairs_main_lights', 'on') and state_attr('light.stairs_main_lights', 'brightness') | int(0) in range(28, 49),
          is_state('light.gym_main_lights', 'on') and state_attr('light.gym_main_lights', 'brightness') | int(0) in range(28, 49),
          is_state('light.laundry_room_main_lights', 'on') and state_attr('light.laundry_room_main_lights', 'brightness') | int(0) in range(28, 49)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:lamps

    - name: "Scene Basement Work"
      unique_id: scene_basement_work
      state: >
        {% set checks = [
          is_state('light.media_room_main_lights', 'on') and state_attr('light.media_room_main_lights', 'brightness') | int(0) in range(92, 113),
          is_state('light.media_room_table_lamp', 'on') and state_attr('light.media_room_table_lamp', 'brightness') | int(0) in range(117, 138),
          is_state('light.basement_hallway_main_lights', 'on') and state_attr('light.basement_hallway_main_lights', 'brightness') | int(0) in range(53, 74),
          is_state('light.gym_main_lights', 'on') and state_attr('light.gym_main_lights', 'brightness') | int(0) in range(53, 74)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:desk-lamp

    - name: "Scene Upstairs Evening"
      unique_id: scene_upstairs_evening
      state: >
        {% set checks = [
          is_state('light.office_floor_lamp', 'on') and state_attr('light.office_floor_lamp', 'brightness') | int(0) in range(66, 87),
          is_state('light.upstairs_hallway_main_lights', 'on') and state_attr('light.upstairs_hallway_main_lights', 'brightness') | int(0) in range(15, 36),
          is_state('light.eve_light_strip_a5a4', 'on') and state_attr('light.eve_light_strip_a5a4', 'brightness') | int(0) in range(64, 85)
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:moon-waning-crescent

    - name: "Scene Outdoor On"
      unique_id: scene_outdoor_on
      state: >
        {% set checks = [
          is_state('light.patio_back_porch_lights', 'on') and state_attr('light.patio_back_porch_lights', 'brightness') | int(0) in range(53, 74),
          is_state('light.driveway_sconces', 'on') and state_attr('light.driveway_sconces', 'brightness') | int(0) in range(53, 74),
          is_state('light.front_porch_overhead_light', 'on') and state_attr('light.front_porch_overhead_light', 'brightness') | int(0) in range(53, 74),
          is_state('switch.driveway_zone_2_2', 'on'),
          is_state('switch.driveway_zone_3_2', 'on'),
          is_state('switch.driveway_zone_1_2', 'on'),
          is_state('switch.transformer_zone_2', 'on'),
          is_state('switch.transformer_zone_1', 'on'),
          is_state('switch.transformer_zone_3', 'on'),
          is_state('switch.smart_switch_2302084653898257090148e1e9b9ccaa_outlet', 'on')
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:outdoor-lamp

    - name: "Scene Outdoor On Bright"
      unique_id: scene_outdoor_on_bright
      state: >
        {% set checks = [
          is_state('light.patio_back_porch_lights', 'on') and state_attr('light.patio_back_porch_lights', 'brightness') | int(0) in range(245, 266),
          is_state('light.driveway_sconces', 'on') and state_attr('light.driveway_sconces', 'brightness') | int(0) in range(245, 266),
          is_state('light.front_porch_overhead_light', 'on') and state_attr('light.front_porch_overhead_light', 'brightness') | int(0) in range(245, 266),
          is_state('switch.driveway_zone_2_2', 'on'),
          is_state('switch.driveway_zone_3_2', 'on'),
          is_state('switch.driveway_zone_1_2', 'on'),
          is_state('switch.transformer_zone_2', 'on'),
          is_state('switch.transformer_zone_1', 'on'),
          is_state('switch.transformer_zone_3', 'on')
        ] %}
        {{ checks | select('equalto', true) | list | count >= (checks | count * 0.95) }}
      icon: mdi:outdoor-lamp

    - name: "Scene Outdoor Off"
      unique_id: scene_outdoor_off
      state: >
        {% set checks = [
          is_state('light.patio_back_porch_lights', 'off'),
          is_state('light.driveway_sconces', 'off'),
          is_state('light.front_porch_overhead_light', 'off'),
          is_state('switch.driveway_zone_2_2', 'off'),
          is_state('switch.driveway_zone_3_2', 'off'),
          is_state('switch.driveway_zone_1_2', 'off'),
          is_state('switch.transformer_zone_1', 'off'),
          is_state('switch.transformer_zone_2', 'off'),
          is_state('switch.transformer_zone_3', 'off'),
          is_state('switch.smart_switch_2302084653898257090148e1e9b9ccaa_outlet', 'off')
        ] %}
        {{ checks | select('equalto', true) | list | count == checks | count }}
      icon: mdi:lightbulb-multiple-off-outline
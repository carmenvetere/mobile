# lovelace_gen
type: vertical-stack
cards:
# Door Open - After 7PM, Before 7AM - Basement Wall Panel
# HIGHEST PRIORITY: Always shows when doors are open at night
{% if dashboard == 'basement_wall_panel' %}
  - type: custom:button-card
    visibility:
      - condition: and
        conditions:
          - condition: time
            after: "19:00:00"
            before: "07:00:00"
          - condition: state
            entity: binary_sensor.all_doors_including_garage
            state: "on"
    styles:
      card:
        - height: 135px
        - width: 600px
        - background: var(--background-color)
        - border-radius: 30px
        - padding-left: 20px
        - padding-top: 0px
      grid:
        - grid-template-areas: |
            "icon name"
        - grid-template-columns: 100px 500px
        - grid-template-rows: 135px
        - column-gap: 5px
        - row-gap: 5px
    custom_fields:
      name:
        card:
          type: custom:button-card
          name: Door Open
          show_name: true
          show_state: false
          show_icon: false
          styles:
            card:
              - height: 135px
              - width: 500px
              - background-color: transparent
              - margin-left: "-20px"
            name:
              - font-size: 36px
              - font-weight: bold
              - color: var(--text-color)
              - text-align: left
              - justify-self: start
      icon:
        card:
          type: custom:button-card
          icon: mdi:lock-open-alert
          styles:
            icon:
              - color: '#F6CE46'
              - height: 60px
              - width: 60px
            card:
              - background-color: transparent
              - height: 150px
              - width: 100px
{% endif %}
# All Closed - After 7PM, Before 7AM - Basement Wall Panel
# LOWEST PRIORITY: Only shows if no other alerts are active
{% if dashboard == 'basement_wall_panel' %}
  - type: custom:button-card
    visibility:
      - condition: and
        conditions:
          - condition: time
            after: "19:00:00"
            before: "07:00:00"
          - condition: state
            entity: binary_sensor.all_doors_including_garage
            state: "off"
          # Only show if no higher priority items
          - condition: state
            entity: binary_sensor.r1t_charging_status
            state: "off"
          - condition: state
            entity: sensor.dryer
            state: "off"
          - condition: state
            entity: sensor.front_load_washer
            state: "off"
    styles:
      card:
        - height: 135px
        - width: 600px
        - background: var(--background-color)
        - border-radius: 30px
        - padding-left: 20px
        - padding-top: 0px
      grid:
        - grid-template-areas: |
            "icon name"
        - grid-template-columns: 100px 500px
        - grid-template-rows: 135px
        - column-gap: 5px
        - row-gap: 5px
    custom_fields:
      name:
        card:
          type: custom:button-card
          name: All Closed
          show_name: true
          show_state: false
          show_icon: false
          styles:
            card:
              - height: 135px
              - width: 500px
              - background-color: transparent
              - margin-left: "-20px"
            name:
              - font-size: 36px
              - font-weight: bold
              - color: var(--text-color)
              - text-align: left
              - justify-self: start
      icon:
        card:
          type: custom:button-card
          icon: mdi:lock
          styles:
            icon:
              - color: var(--accent-color-2)
              - height: 60px
              - width: 60px
            card:
              - background-color: transparent
              - height: 150px
              - width: 100px
{% endif %}
# Rivian Charging - Basement Wall Panel Day
# PRIORITY 2: Only shows if doors are closed
{% if dashboard == 'basement_wall_panel' %}
  - type: custom:button-card
    visibility:
      - condition: and
        conditions:
          - condition: state
            entity: binary_sensor.r1t_charging_status
            state: "on"
          # Don't show if door is open (higher priority)
          - condition: state
            entity: binary_sensor.all_doors_including_garage
            state: "off"
    styles:
      card:
        - height: 135px
        - width: 600px
        - background: var(--background-color)
        - border-radius: 30px
        - padding-left: 20px
        - margin-left: 10px
        - margin-bottom: 50px
      grid:
        - grid-template-areas: |
            "name name time"
            "slider slider slider"
        - grid-template-columns: 75px 525px
        - grid-template-rows: 35px 105px
        - column-gap: 0px
        - row-gap: 5px
        - align-items: start
        - justify-items: flex-center
      custom_fields: 
        name: 
          - justify-items: flex-start
        slide: 
          - margin-bottom: 10px
    custom_fields:
      name:
        card:
          type: custom:button-card
          name: Rivian R1T Charging
          show_name: true
          show_state: false
          show_icon: false
          styles:
            card:
              - height: 65px
              - width: 580px
              - background-color: transparent
            name:
              - font-size: 28px
              - font-weight: bold
              - color: var(--text-color)
              - text-align: left
              - justify-self: flex-start
      slider:
        card:
          type: custom:bubble-card
          card_type: button
          button_type: slider
          sub_button:
            main:
              - entity: sensor.r1t_estimated_vehicle_range
                show_state: true
                show_icon: false
                state_background: true
                show_background: false
                name: ""
                show_name: false
              - entity: sensor.r1t_battery_state_of_charge
                show_icon: false
                show_state: true
                state_background: false
                show_background: false
            bottom: []
          entity: sensor.r1t_battery_state_of_charge
          show_name: false
          modules:
            - wall_panel_charging
{% endif %}
#Dryer When Running - Basement Panel.
# PRIORITY 3: Only shows if no door open or charging
{% if dashboard == 'basement_wall_panel' %}
  - type: custom:button-card
    visibility:
      - condition: and
        conditions:
          - condition: state
            entity: sensor.dryer
            state: "on"
          # Don't show if higher priority items active
          - condition: state
            entity: binary_sensor.all_doors_including_garage
            state: "off"
          - condition: state
            entity: binary_sensor.r1t_charging_status
            state: "off"
    styles:
      card:
        - height: 135px
        - width: 600px
        - background: var(--background-color-2)
        - border-radius: 30px
        - padding-left: 20px
        - padding-top: 0px
      grid:
        - grid-template-areas: |
            "icon name time"
        - grid-template-columns: 100px 150px 350px
        - grid-template-rows: 135px
        - column-gap: 0px
        - row-gap: 5px
    custom_fields:
      name:
        card:
          type: custom:button-card
          name: Dryer
          show_name: true
          show_state: false
          show_icon: false
          styles:
            card:
              - height: 135px
              - width: 150px
              - background-color: transparent
              - margin-left: "-20px"
            name:
              - font-size: 36px
              - font-weight: bold
              - color: var(--text-color)
              - text-align: left
              - justify-self: start
      icon:
        card:
          type: custom:button-card
          icon: mdi:tumble-dryer
          styles:
            icon:
              - color: var(--text-color)
              - height: 60px
              - width: 60px
            card:
              - background-color: transparent
              - height: 150px
              - width: 100px
      time:
        card:
          type: custom:button-card
          entity: sensor.dryer_remaining_time
          show_state: true
          show_label: false
          show_name: false
          show_icon: false
          styles:
            card:
              - height: 135px
              - width: 350px
              - background: transparent
            state:
              - font-size: 46px
              - font-weight: bold
              - color: var(--text-color)
{% endif %}
#Washer When Running
# PRIORITY 4: Only shows if no door open, charging, or dryer running
{% if dashboard == 'basement_wall_panel' %}
  - type: custom:button-card
    visibility:
      - condition: and
        conditions:
          - condition: state
            entity: sensor.front_load_washer
            state: 'on'
          # Don't show if higher priority items active
          - condition: state
            entity: binary_sensor.all_doors_including_garage
            state: "off"
          - condition: state
            entity: binary_sensor.r1t_charging_status
            state: "off"
          - condition: state
            entity: sensor.dryer
            state: "off"
    styles:
      card:
        - height: 135px
        - width: 600px
        - background: var(--background-color-2)
        - border-radius: 30px
        - padding-left: 20px
        - padding-top: 0px
      grid:
        - grid-template-areas: |
            "icon name time"
        - grid-template-columns: 100px 150px 350px
        - grid-template-rows: 135px
        - column-gap: 0px
        - row-gap: 5px
    custom_fields:
      name:
        card:
          type: custom:button-card
          name: Washer
          show_name: true
          show_state: false
          show_icon: false
          styles:
            card:
              - height: 135px
              - width: 150px
              - background-color: transparent
              - margin-left: "-20px"
            name:
              - font-size: 36px
              - font-weight: bold
              - color: var(--text-color)
              - text-align: left
              - justify-self: start
      icon:
        card:
          type: custom:button-card
          icon: mdi:washing-machine
          styles:
            icon:
              - color: var(--text-color)
              - height: 60px
              - width: 60px
            card:
              - background-color: transparent
              - height: 150px
              - width: 100px
      time:
        card:
          type: custom:button-card
          entity: sensor.front_load_washer_remaining_time
          show_state: true
          show_label: false
          show_name: false
          show_icon: false
          styles:
            card:
              - height: 135px
              - width: 350px
              - background: transparent
            state:
              - font-size: 46px
              - font-weight: bold
              - color: var(--text-color)
{% endif %}
# Greeting Card - Basement Wall Panel
# LOWEST PRIORITY: Only shows when no other cards are active
{% if dashboard == 'basement_wall_panel' %}
  - type: custom:button-card
    visibility:
      - condition: and
        conditions:
          # Only show if no other cards are showing
          - condition: or
            conditions:
              # Show during the day
              - condition: time
                before: "19:00:00"
              # OR show at night if doors are closed
              - condition: and
                conditions:
                  - condition: time
                    after: "19:00:00"
                  - condition: state
                    entity: binary_sensor.all_doors_including_garage
                    state: "off"
          # Don't show if any higher priority cards are active
          - condition: state
            entity: binary_sensor.r1t_charging_status
            state: "off"
          - condition: state
            entity: sensor.dryer
            state: "off"
          - condition: state
            entity: sensor.front_load_washer
            state: "off"
    show_name: false
    show_icon: false
    show_state: false
    styles:
      card:
        - background: transparent
        - box-shadow: none
        - height: 135px
        - width: 600px
        - padding: 20px
      custom_fields:
        hello:
          - font-size: 42px
          - font-weight: bold
          - color: var(--text-color)
          - margin-bottom: 10px
        status:
          - font-size: 20px
          - line-height: 1.5
          - color: var(--text-color)
      grid:
        - grid-template-areas: |
            "hello"
            "status"
        - grid-template-rows: auto auto
    custom_fields:
      hello: |
        [[[
          return "Hello!";
        ]]]
      status: |
        [[[
          // Door status
          let doorStatus = "";
          if (states['binary_sensor.all_doors_including_garage'].state === 'off') {
            doorStatus = "All doors are closed";
          } else {
            // Count open doors by checking attributes
            let doorCount = 0;
            const groupAttrs = states['binary_sensor.all_doors_including_garage'].attributes.entity_id || [];
            groupAttrs.forEach(entityId => {
              if (states[entityId] && states[entityId].state === 'on') doorCount++;
            });
            doorStatus = doorCount + " door" + (doorCount !== 1 ? "s are" : " is") + " open";
          }

          // Alarm status
          let alarmState = states['alarm_control_panel.alarmo'].state.replace(/_/g, ' ');

          // HVAC mode and average temp
          let livingMode = states['climate.living_room_thermostat'].state;
          let basementMode = states['climate.basement_thermostat'].state;
          let officeMode = states['climate.office_thermostat'].state;
          let bedroomMode = states['climate.master_bedroom_thermostat'].state;

          let heatCount = [livingMode, basementMode, officeMode, bedroomMode].filter(m => m === 'heat').length;
          let coolCount = [livingMode, basementMode, officeMode, bedroomMode].filter(m => m === 'cool').length;

          let hvacText = "The climate";
          if (heatCount > coolCount) hvacText = "The heat";
          else if (coolCount > 0) hvacText = "The air conditioning";

          // Average temperature
          let temps = [
            parseFloat(states['climate.living_room_thermostat'].attributes.temperature) || 0,
            parseFloat(states['climate.basement_thermostat'].attributes.temperature) || 0,
            parseFloat(states['climate.office_thermostat'].attributes.temperature) || 0,
            parseFloat(states['climate.master_bedroom_thermostat'].attributes.temperature) || 0
          ];
          let avgTemp = Math.round(temps.reduce((a, b) => a + b, 0) / temps.length);

          return doorStatus + " and the alarm is " + alarmState + ". " + hvacText + " in the house is set to " + avgTemp + "Â°F.";
        ]]]
{% endif %}



